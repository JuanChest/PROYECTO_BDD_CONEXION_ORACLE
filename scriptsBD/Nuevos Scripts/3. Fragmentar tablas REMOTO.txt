-- ==========================
-- Fragmentación Horizontal en REMOTO (tiendasNorte)
-- ==========================

-- 1️⃣ Fragmento de TIENDA (solo Región Norte)
CREATE TABLE TIENDA_NORTE AS
SELECT *
FROM TIENDA@db_link_master
WHERE REGION_ID = 1;

-- 2️⃣ Fragmento de INVENTARIO (derivado de TIENDA)
CREATE TABLE INVENTARIO_NORTE AS
SELECT inv.*
FROM INVENTARIO@db_link_master inv
JOIN TIENDA@db_link_master t ON inv.ID_TIENDA = t.ID_TIENDA
WHERE t.REGION_ID = 1;

-- 3️⃣ Fragmento de VENTAS (derivado de TIENDA)
CREATE TABLE VENTAS_NORTE AS
SELECT v.*
FROM VENTAS@db_link_master v
JOIN TIENDA@db_link_master t ON v.ID_TIENDA = t.ID_TIENDA
WHERE t.REGION_ID = 1;

-- 4️⃣ Fragmento de DETALLE_VENTA (derivado de VENTAS)
CREATE TABLE DETALLE_VENTA_NORTE AS
SELECT dv.*
FROM DETALLE_VENTA@db_link_master dv
JOIN VENTAS@db_link_master v ON dv.VENTA_ID = v.VENTA_ID
JOIN TIENDA@db_link_master t ON v.ID_TIENDA = t.ID_TIENDA
WHERE t.REGION_ID = 1;


-- ========================================
-- Constraints para tablas fragmentadas en REMOTO
-- ========================================

-- 1️⃣ TIENDA_NORTE
ALTER TABLE TIENDA_NORTE
ADD CONSTRAINT PK_TIENDA_NORTE PRIMARY KEY (ID_TIENDA);

ALTER TABLE TIENDA_NORTE
ADD CONSTRAINT CHK_TIENDA_NORTE_REGION CHECK (REGION_ID = 1);

-- 2️⃣ INVENTARIO_NORTE
ALTER TABLE INVENTARIO_NORTE
ADD CONSTRAINT PK_INVENTARIO_NORTE PRIMARY KEY (INVENTARIO_ID);

ALTER TABLE INVENTARIO_NORTE
ADD CONSTRAINT FK_INV_NORTE_TIENDA FOREIGN KEY (ID_TIENDA)
REFERENCES TIENDA_NORTE(ID_TIENDA);

ALTER TABLE INVENTARIO_NORTE
ADD CONSTRAINT FK_INV_NORTE_PRODUCTO FOREIGN KEY (PRODUCTO_ID)
REFERENCES PRODUCTO(PRODUCTO_ID);

-- 3️⃣ VENTAS_NORTE
ALTER TABLE VENTAS_NORTE
ADD CONSTRAINT PK_VENTAS_NORTE PRIMARY KEY (VENTA_ID);

ALTER TABLE VENTAS_NORTE
ADD CONSTRAINT FK_VENTAS_NORTE_TIENDA FOREIGN KEY (ID_TIENDA)
REFERENCES TIENDA_NORTE(ID_TIENDA);

ALTER TABLE VENTAS_NORTE
ADD CONSTRAINT FK_VENTAS_NORTE_CLIENTE FOREIGN KEY (CLIENTE_ID)
REFERENCES CLIENTE(CLIENTE_ID);

-- 4️⃣ DETALLE_VENTA_NORTE
ALTER TABLE DETALLE_VENTA_NORTE
ADD CONSTRAINT PK_DV_NORTE PRIMARY KEY (VENTA_ID, DETALLE_ID);

ALTER TABLE DETALLE_VENTA_NORTE
ADD CONSTRAINT FK_DV_NORTE_VENTA FOREIGN KEY (VENTA_ID)
REFERENCES VENTAS_NORTE(VENTA_ID);

ALTER TABLE DETALLE_VENTA_NORTE
ADD CONSTRAINT FK_DV_NORTE_PRODUCTO FOREIGN KEY (PRODUCTO_ID)
REFERENCES PRODUCTO(PRODUCTO_ID);
