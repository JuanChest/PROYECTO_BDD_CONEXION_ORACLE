-- Fragmentar las tablas en REMOTO

-- Fragmento de TIENDA (solo Regi√≥n Norte)
CREATE TABLE TIENDA_NORTE (
    ID_TIENDA     NUMBER PRIMARY KEY,
    REGION_ID     NUMBER CHECK (REGION_ID = 1),
    NOMBRE        VARCHAR2(50),
    DIRECCION     VARCHAR2(50)
);

INSERT INTO TIENDA_NORTE
SELECT ID_TIENDA, REGION_ID, NOMBRE, DIRECCION
FROM TIENDA@db_link_master
WHERE REGION_ID = 1;

--Fragmento de INVENTARIO (derivado de TIENDA)
CREATE TABLE INVENTARIO_NORTE (
    INVENTARIO_ID NUMBER PRIMARY KEY,
    ID_TIENDA     NUMBER,
    PRODUCTO_ID   NUMBER,
    CANTIDAD      NUMBER,
    CONSTRAINT FK_INVENTARIO_NORTE_TIENDA FOREIGN KEY (ID_TIENDA) REFERENCES TIENDA_NORTE(ID_TIENDA),
    CONSTRAINT FK_INVENTARIO_NORTE_PRODUCTO FOREIGN KEY (PRODUCTO_ID) REFERENCES PRODUCTO(PRODUCTO_ID)
);

INSERT INTO INVENTARIO_NORTE (INVENTARIO_ID, ID_TIENDA, PRODUCTO_ID, CANTIDAD)
SELECT INVENTARIO_ID, ID_TIENDA, PRODUCTO_ID, CANTIDAD
FROM INVENTARIO@db_link_master inv
JOIN TIENDA@db_link_master t ON inv.ID_TIENDA = t.ID_TIENDA
WHERE t.REGION_ID = 1;

-- Fragmento de VENTAS (derivado de TIENDA)
CREATE TABLE VENTAS_NORTE (
    VENTA_ID      NUMBER PRIMARY KEY,
    ID_TIENDA     NUMBER,
    CLIENTE_ID    NUMBER,
    FECHA         DATE,
    TOTAL         NUMBER(10,2),
    CONSTRAINT FK_VENTAS_NORTE_TIENDA FOREIGN KEY (ID_TIENDA) REFERENCES TIENDA_NORTE(ID_TIENDA),
    CONSTRAINT FK_VENTAS_NORTE_CLIENTE FOREIGN KEY (CLIENTE_ID) REFERENCES CLIENTE(CLIENTE_ID)
);

INSERT INTO VENTAS_NORTE (VENTA_ID, ID_TIENDA, CLIENTE_ID, FECHA, TOTAL)
SELECT VENTA_ID, ID_TIENDA, CLIENTE_ID, FECHA, TOTAL
FROM VENTAS@db_link_master v
JOIN TIENDA@db_link_master t ON v.ID_TIENDA = t.ID_TIENDA
WHERE t.REGION_ID = 1;

-- Fragmento de DETALLE_VENTA (derivado de VENTAS)
CREATE TABLE DETALLE_VENTA_NORTE (
    VENTA_ID      NUMBER,
    DETALLE_ID    NUMBER,
    PRODUCTO_ID   NUMBER,
    CANTIDAD      NUMBER,
    PRECIO_UNITARIO NUMBER(10,2),
    SUB_TOTAL    NUMBER(10,2),
    CONSTRAINT PK_DETALLE_VENTA_NORTE PRIMARY KEY (VENTA_ID, DETALLE_ID),
    CONSTRAINT FK_DETALLE_VENTA_NORTE_PRODUCTO FOREIGN KEY (PRODUCTO_ID) REFERENCES PRODUCTO(PRODUCTO_ID),
    CONSTRAINT FK_DETALLE_VENTA_NORTE_VENTAS FOREIGN KEY (VENTA_ID) REFERENCES VENTAS_NORTE(VENTA_ID)
);

INSERT INTO DETALLE_VENTA_NORTE (VENTA_ID, DETALLE_ID, PRODUCTO_ID, CANTIDAD, PRECIO_UNITARIO, SUB_TOTAL)
SELECT dv.VENTA_ID, dv.DETALLE_ID, dv.PRODUCTO_ID, dv.CANTIDAD, dv.PRECIO_UNITARIO, dv.SUB_TOTAL
FROM DETALLE_VENTA@db_link_master dv
JOIN VENTAS@db_link_master v ON dv.VENTA_ID = v.VENTA_ID
JOIN TIENDA@db_link_master t ON v.ID_TIENDA = t.ID_TIENDA
WHERE t.REGION_ID = 1;
